database com.justeat.TakeawaysDB

migration 27 {
    /*
     * No need for these anymore
     */
        drop trigger update_product_basket_quantity_on_basket_items_deleted;
        drop trigger update_product_basket_quantity_on_basket_items_inserted;
        drop trigger update_product_basket_quantity_on_basket_items_updated;
        drop trigger update_product_basket_quantity_on_products_inserted;
    }
    
migration 28 {
    alter table basket_items add column group_key text;
}
    
migration 29 {
    
    alter table basket_items add column product_synonym text;
    alter table basket_items add column product_has_accessories boolean;
    alter table basket_items add column product_has_combo_options boolean;
    
    alter table orders add column delivery_charge real;
    alter table orders add column sub_total real;
    alter table orders add column discount real;
    alter table orders add column multibuy_discount real;
        
    create table order_history_items (
        _id integer primary key autoincrement,
        basket_jeid text,
        basket_item_jeid text,
        restaurant_jeid integer,
        menu_jeid integer,
        category_jeid integer,
        product_jeid integer,
        is_complex boolean,
        product_name text,
        product_synonym text,
        product_has_accessories boolean,
        product_has_combo_options boolean,
        description text,
        product_price real,
        total_price real,
        is_tips boolean,
        menu_sort_key text,
        group_key text,
        unique (
            basket_jeid,
            basket_item_jeid,
            restaurant_jeid
        ) on conflict replace
    );

    create table order_history_item_mealparts (
        _id integer primary key autoincrement,
        basket_jeid text,
        basket_item_jeid text,
        mealpart_jeid integer,
        mealpart_name text,
        mealpart_group_jeid integer,
        has_accessories boolean,
        has_required_accessories boolean,
        unique (
            basket_jeid,
            basket_item_jeid, 
            mealpart_jeid, 
            mealpart_group_jeid
        ) on conflict replace
    );

    create table order_history_item_accessories (
        _id integer primary key autoincrement,
        basket_jeid text,
        basket_item_jeid text,
        product_jeid integer,
        accessory_jeid integer,
        accessory_group_jeid integer,
        accessory_name text,
        accessory_required integer default(0),
        mealpart_jeid integer default(0), 
        mealpart_group_jeid integer default(0), 
        unit_price real,
        quantity integer,
        unique (
            basket_jeid,
            basket_item_jeid, 
            product_jeid, 
            accessory_jeid, 
            accessory_group_jeid,
            accessory_required,
            mealpart_jeid,
            mealpart_group_jeid
        ) on conflict replace
    );
}
    
migration 30 {
    drop table product_categories;
    
    create table product_categories (
        _id integer primary key autoincrement,
        jeid integer,
        restaurant_jeid integer,
        menu_jeid integer,
        name text,
        description text,
        special_offer text,
		unique(jeid, restaurant_jeid, menu_jeid) on conflict replace
	);
}
    
migration 31 {
	alter table recently_viewed_restaurants add column query text;
}

migration 32 {
    alter table basket_items add column user text;
	alter table order_history_items add column user text;
}

migration 33 {
	alter table orders add column order_id text;
	alter table orders add column order_status text;
}

migration 34 {
	alter table orders add column delivery_address text;
	alter table orders add column delivery_city text;
	alter table orders add column delivery_postcode text;
}

migration 35 {
	alter table orders add column initial_estimated_delivery_time text;
	alter table orders add column placed_date text;

	alter table orders add column payment_is_card boolean;
	alter table orders add column payment_card_type text;
	alter table orders add column payment_card_digits text;
    alter table orders add column payment_card_charge real;
}

migration 36 {
    alter table orders add column estimated_delivery_date integer;
}

migration 37 {
	alter table orders add column is_restaurant_open_now boolean;
	alter table orders add column is_restaurant_offline boolean;
	alter table orders add column is_restaurant_new boolean;
	alter table orders add column restaurant_seo_name text;
	alter table orders add column restaurant_description text;
}

migration 38 {
	alter table orders add column is_reordable boolean;
}

migration 39 {
	create table user_details (
		_id integer primary key autoincrement,
		tracking_id text,
		created_date text,
		email text,
		first_name text,
		last_name text,
		phone_number text,
		date_of_birth text,
		terms_id integer,
		wants_newsletter boolean
	);
}
    
migration 40 {
	create table payment_lines (
	    _id integer primary key autoincrement,
	    order_id text,
	    item_id integer,
	    type text,
	    value real,
	    card_type text,
	    card_digits text,
	    unique(order_id, item_id) on conflict replace
	);
}

migration 41 {
    alter table orders add column total_complementary real;
}

migration 42 {
    alter table product_categories add column sort_key text;
}